# Maven package Java project Web App to Linux on Azure
# Build your Java project and deploy it to Azure as a Linux web app
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- none
# - master

variables:

  ### Variables ###
  accountName: 'stage'
  applicationName: 'erebus'
  prefix: '$(accountName)-$(applicationName)'
  webAppName: '$(prefix)-app'
  resourceGroupName: '$(prefix)-rg'
  servicePlan: '$(prefix)-sp'
  vmImageName: 'ubuntu-latest'
  location: 'East US'

pool:
  vmImage: 'ubuntu-latest'

stages:

  ### Initialize Azure Stage ###
  - stage: Init_Env
    jobs:
      - job: Init_Env
        steps:

        ### Create Service Plan  ###
        - task: AzureResourceManagerTemplateDeployment@3
          inputs:
            deploymentScope: 'Resource Group'
            azureResourceManagerConnection: 'stage(39fa8f87-83f2-4d92-a424-408ebdfbeb19)'
            subscriptionId: '39fa8f87-83f2-4d92-a424-408ebdfbeb19'
            action: 'Create Or Update Resource Group'
            resourceGroupName: 'stage-erebus-rg'
            location: 'East US'
            templateLocation: 'Linked artifact'
            csmFile: 'azure-arm/erebus-sp.json'
            deploymentMode: 'Incremental'

